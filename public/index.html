<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        body {
            display: grid;
            max-width: 100vw;
            background-color: #ebe9e9;
            min-height: 100vh;
        }

        #wrapper {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            min-height: 100%;
        }

        #superior {
            display: flex;
            justify-content: space-around;
            padding: 15px;
        }

        #inferior{
            display: flex;
            align-items: center;
            justify-content: center;
        }

        

        #screen {
            border: 10px solid #CCC;
            border-radius: 5px;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            image-rendering: -moz-crisp-edges;
            width: 600px;
            height: 600px;
        }

        #rank_mask {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 300px;
            height: 600px;
            border: 10px solid #CCC;
            border-radius: 5px;
        }

        #rank {
            width: 270px;
            height: 570px;
            overflow-y: auto;
            overflow-x: hidden;
            background-color: antiquewhite;
        }

        #chat_div {
            height: 200px;
            width: 95%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            border: 10px solid #CCC;
            background-color: aquamarine;
        }

        #chat_mask {
            position: relative;
            bottom: 0;
            height: 250px;
            overflow-y: auto;
            overflow-x: hidden;
            margin: 15px 15px 5px 15px;
            background-color: aqua;
        }

        #input {
            margin: 5px 5px 0px 0px;
        }

        #messages {
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            max-width: 100%;

        }

        #messages li {
            display: flex;
            justify-content: flex-start;
            margin-bottom: 5px;
            max-width: 100%;
        }

        #form {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 15px;
        }

        #plyer_1{
        }
        #player_2{
            background-color: aqua;
        }
    </style>
    <script src="/socket.io/socket.io.js"></script>
</head>

<body>
    <div id="wrapper">
        <div id="superior">
            <canvas id="screen" width="600" height="600">
                <img id="plyer_1" src="data:image/jpeg;base64,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" alt="">
                <img id="player_2" src="https://cdn1.iconfinder.com/data/icons/video-games-14/24/video-game-character-512.png" alt="" srcset="">
                <img id="fruit" src="https://i.pinimg.com/736x/4b/ba/73/4bba735cc7037f057f41e241cb740b99.jpg" alt="" srcset="">
            </canvas>
            <div id="rank_mask">
                <div id="rank">
                    <ul id="rak_list">
                        
                    </ul>
                </div>
            </div>
        </div>

        <div id="inferior">
            <div id="chat_div">
                <div id="chat_mask">
                    <ul id="messages">
                        <!-- chat content
                        <li></li>
                     -->
                    </ul>
                </div>
                <form id="form" action="">
                    <input type="text" name="" id="input" autocomplete="off" /><button>Send</button>
                </form>
            </div>
        </div>
    </div>



    <script type="module">
        import createGame from './game.js'
        import createKeyboardListener from './keyBoardListener.js'
        import renderScreen from './renderScreen.js'
        import sendMessage from './chat.js'
        import poitnsManager from './pointsManager.js'

        const playerName = ""

        /* while (playerName === ""){
            
        } */
        const game = createGame()
        const keyboardListener = createKeyboardListener(document)
        const sendMsg = sendMessage(document)
        const updatePoints = poitnsManager(document)
        //keyboardListener.subscribe(game.movePlayer)
        

        const socket = io()
        socket.on('connect', () => {


            const playerId = socket.id
            const screen = document.getElementById('screen')
            renderScreen(screen, game, requestAnimationFrame, playerId)
        })
        socket.on('setup', (state) => {
            const playerId = socket.id
            game.setState(state)
            
            const command = {
                rank: state.rank
            }
            updatePoints.updatePoints(command)
            //poitnsManager.updatePoints(state.rank)
            

            keyboardListener.registerPlayerId(playerId)
            keyboardListener.subscribe(game.movePlayer)
            keyboardListener.subscribe((command) => {
                socket.emit('movePlayer', command)
            })

            updatePoints.registerPlayerId(playerId)
            updatePoints.subscribe(game.updatePoits)
            updatePoints.subscribe((command) => {
                socket.emit('updatePoints', command)
            })

            sendMsg.registerPlayerId(playerId)
            sendMsg.subscribe(game.sendMessage)
            sendMsg.subscribe((command) => {
                socket.emit('message', command)
            })
        })
        socket.on('addplayer', (command) => {
            game.addPlayer(command)
            command = {
                rank: game.state.rank
            }
            updatePoints.updatePoints(command)
        })
        socket.on('removePlayer', (command) => {
            game.removePlayer(command)
            command = {
                rank: game.state.rank
            }
            console.log(command)
            updatePoints.updatePoints(command)
        })
        socket.on('movePlayer', (command) => {
            const playerId = socket.id
            if (playerId !== command.playerId) {
                game.movePlayer(command)
            }
        })
        socket.on('addFruit', (command) => {
            game.addFruit(command)
        })
        socket.on('removeFruit', (command) => {
            game.removeFruits(command)
        })
        socket.on('message', (command) => {
            sendMsg.receiveMessege(command)
        })
        socket.on('updatePoints', (command) => {
            updatePoints.updatePoints(command)
        })


    </script>
</body>

</html>